# OneValue Delivery Intelligence Console - System Architecture

## High-Level Architecture Diagram

```
┌─────────────────────────────────────────────────────────────────────────────────────┐
│                                    USERS                                             │
│                                                                                      │
│    ┌──────────────┐    ┌──────────────┐    ┌──────────────┐                         │
│    │    Admin     │    │      PM      │    │    Viewer    │                         │
│    │ @oneorigin.us│    │ @oneorigin.us│    │ @oneorigin.us│                         │
│    └──────┬───────┘    └──────┬───────┘    └──────┬───────┘                         │
│           │                   │                   │                                  │
└───────────┼───────────────────┼───────────────────┼──────────────────────────────────┘
            │                   │                   │
            └───────────────────┼───────────────────┘
                                │
                    ┌───────────▼───────────┐
                    │    Google OAuth 2.0   │
                    │   (Domain Restricted) │
                    └───────────┬───────────┘
                                │
┌───────────────────────────────┼──────────────────────────────────────────────────────┐
│                               │           FRONTEND                                    │
│                    ┌──────────▼──────────┐                                           │
│                    │   React + Vite App  │                                           │
│                    │   localhost:3000    │                                           │
│                    │   Docker:3001       │                                           │
│                    └──────────┬──────────┘                                           │
│                               │                                                       │
│    ┌──────────────────────────┼──────────────────────────────────────┐               │
│    │                          │                                       │               │
│    ▼                          ▼                          ▼            ▼               │
│ ┌────────┐  ┌────────┐  ┌──────────┐  ┌────────┐  ┌────────┐  ┌──────────┐          │
│ │Overview│  │Project │  │ Actions  │  │Renewals│  │ Alerts │  │  Admin   │          │
│ │Dashboard│ │ Detail │  │  Queue   │  │  Page  │  │  Page  │  │  Panel   │          │
│ └────────┘  └────────┘  └──────────┘  └────────┘  └────────┘  └──────────┘          │
│                                                                                       │
│                         Apple Tahoe OS26 Design System                               │
│                    (Glass Morphism, Inter Font, Dark Mode)                           │
└───────────────────────────────┬──────────────────────────────────────────────────────┘
                                │
                    Supabase Client (Real-time)
                                │
┌───────────────────────────────┼──────────────────────────────────────────────────────┐
│                               │           SUPABASE                                    │
│                    ┌──────────▼──────────┐                                           │
│                    │   PostgreSQL DB     │                                           │
│                    │   + Row Level       │                                           │
│                    │     Security (RLS)  │                                           │
│                    └──────────┬──────────┘                                           │
│                               │                                                       │
│    ┌──────────────────────────┴──────────────────────────────────────┐               │
│    │                                                                  │               │
│    ▼                          ▼                          ▼            ▼               │
│ ┌──────────────┐  ┌──────────────────┐  ┌──────────────┐  ┌────────────────┐        │
│ │sow_contracts │  │delivery_         │  │action_queue  │  │user_allowlist  │        │
│ │   (30)       │  │intelligence(1300)│  │    (7)       │  │     (3)        │        │
│ └──────────────┘  └──────────────────┘  └──────────────┘  └────────────────┘        │
│                                                                                       │
│ ┌──────────────┐  ┌──────────────────┐  ┌──────────────┐  ┌────────────────┐        │
│ │project_health│  │chat_spaces       │  │alert_        │  │system_audit_   │        │
│ │_metrics (10) │  │    (10)          │  │notifications │  │logs            │        │
│ └──────────────┘  └──────────────────┘  └──────────────┘  └────────────────┘        │
│                                                                                       │
│                              VIEWS                                                    │
│    ┌──────────────────┐  ┌──────────────────┐  ┌──────────────────┐                 │
│    │portfolio_overview│  │action_queue_full │  │renewal_readiness │                 │
│    └──────────────────┘  └──────────────────┘  └──────────────────┘                 │
│                                                                                       │
│                    https://osmdiezkqgfrhhsgtomo.supabase.co                          │
└───────────────────────────────┬──────────────────────────────────────────────────────┘
                                │
                                │ REST API + Service Role
                                │
┌───────────────────────────────┼──────────────────────────────────────────────────────┐
│                               │           n8n CLOUD                                   │
│                    ┌──────────▼──────────┐                                           │
│                    │  Workflow Engine    │                                           │
│                    │  7 Active Workflows │                                           │
│                    └──────────┬──────────┘                                           │
│                               │                                                       │
│    ┌──────────────────────────┼──────────────────────────────────────┐               │
│    │                          │                                       │               │
│    ▼                          ▼                          ▼            ▼               │
│ ┌────────────┐  ┌────────────┐  ┌────────────┐  ┌────────────┐  ┌────────────┐      │
│ │01_Historical│ │03_Daily    │  │04_AI       │  │05_Alert    │  │06_Critical │      │
│ │Data Dump   │  │Poller      │  │Analyzer    │  │Manager     │  │Notifier    │      │
│ │(Manual)    │  │(9AM Daily) │  │(2 Hours)   │  │(On Error)  │  │(15 Min)    │      │
│ └─────┬──────┘  └─────┬──────┘  └─────┬──────┘  └─────┬──────┘  └─────┬──────┘      │
│       │               │               │               │               │              │
│                    https://airr-marketing.app.n8n.cloud                              │
└───────┼───────────────┼───────────────┼───────────────┼───────────────┼──────────────┘
        │               │               │               │               │
        ▼               ▼               ▼               ▼               ▼
┌───────────────────────────────────────────────────────────────────────────────────────┐
│                              EXTERNAL SERVICES                                         │
│                                                                                        │
│  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐  │
│  │   Gmail API     │  │ Google Chat API │  │   Claude AI     │  │  Google Drive   │  │
│  │   (OAuth 2.0)   │  │   (OAuth 2.0)   │  │   (Anthropic)   │  │   (OAuth 2.0)   │  │
│  │                 │  │                 │  │                 │  │                 │  │
│  │  Fetch Emails   │  │  Fetch Messages │  │  Analyze Comms  │  │  Parse SOW PDFs │  │
│  │  from .edu      │  │  from MOM Spaces│  │  Sentiment/     │  │  Extract Terms  │  │
│  │  domains        │  │                 │  │  Blockers/      │  │                 │  │
│  │                 │  │                 │  │  Actions        │  │                 │  │
│  └─────────────────┘  └─────────────────┘  └─────────────────┘  └─────────────────┘  │
│                                                                                        │
└────────────────────────────────────────────────────────────────────────────────────────┘
```

---

## Data Flow Diagram

```
┌─────────────────────────────────────────────────────────────────────────────────────┐
│                              DATA INGESTION FLOW                                     │
└─────────────────────────────────────────────────────────────────────────────────────┘

    ┌─────────────┐         ┌─────────────┐         ┌─────────────┐
    │   Gmail     │         │Google Chat  │         │Google Drive │
    │   Inbox     │         │  Spaces     │         │  SOW PDFs   │
    └──────┬──────┘         └──────┬──────┘         └──────┬──────┘
           │                       │                       │
           ▼                       ▼                       ▼
    ┌─────────────┐         ┌─────────────┐         ┌─────────────┐
    │ 01_Historical│        │ 03_Daily    │         │ 02_SOW PDF  │
    │ Data Dump   │         │ Poller      │         │ Ingestor    │
    └──────┬──────┘         └──────┬──────┘         └──────┬──────┘
           │                       │                       │
           └───────────┬───────────┘                       │
                       │                                   │
                       ▼                                   ▼
              ┌─────────────────┐                ┌─────────────────┐
              │ delivery_       │                │ sow_contracts   │
              │ intelligence    │                │                 │
              │ (Raw Messages)  │                │ (Contract Data) │
              └────────┬────────┘                └─────────────────┘
                       │
                       ▼
              ┌─────────────────┐
              │ 04_AI Project   │
              │ Analyzer        │
              │ (Claude API)    │
              └────────┬────────┘
                       │
         ┌─────────────┴─────────────┐
         │                           │
         ▼                           ▼
┌─────────────────┐         ┌─────────────────┐
│ delivery_       │         │ project_health_ │
│ intelligence    │         │ metrics         │
│ (AI Enriched)   │         │                 │
│ - sentiment     │         │ - health_score  │
│ - blockers      │         │ - overall_health│
│ - action_items  │         │ - blocker_count │
└─────────────────┘         └─────────────────┘
```

---

## Authentication & Authorization Flow

```
┌─────────────────────────────────────────────────────────────────────────────────────┐
│                              AUTHENTICATION FLOW                                     │
└─────────────────────────────────────────────────────────────────────────────────────┘

    User                    Frontend                Supabase Auth           Google OAuth
      │                        │                         │                       │
      │   1. Click Login       │                         │                       │
      │───────────────────────>│                         │                       │
      │                        │                         │                       │
      │                        │  2. signInWithOAuth()   │                       │
      │                        │────────────────────────>│                       │
      │                        │                         │                       │
      │                        │                         │  3. Redirect to       │
      │<─────────────────────────────────────────────────│─────Google────────────>
      │                        │                         │                       │
      │                        │                         │  4. User consents     │
      │                        │                         │<──────────────────────│
      │                        │                         │                       │
      │                        │  5. JWT Token +         │                       │
      │                        │<────User Info───────────│                       │
      │                        │                         │                       │
      │                        │  6. Check user_allowlist│                       │
      │                        │────────────────────────>│                       │
      │                        │                         │                       │
      │                        │  7. Return role/status  │                       │
      │                        │<────────────────────────│                       │
      │                        │                         │                       │
      │   8. Dashboard loaded  │                         │                       │
      │<───────────────────────│                         │                       │
      │                        │                         │                       │


┌─────────────────────────────────────────────────────────────────────────────────────┐
│                              AUTHORIZATION (RLS)                                     │
└─────────────────────────────────────────────────────────────────────────────────────┘

                              ┌─────────────────┐
                              │   User Request  │
                              └────────┬────────┘
                                       │
                                       ▼
                              ┌─────────────────┐
                              │ Check JWT Token │
                              └────────┬────────┘
                                       │
                         ┌─────────────┴─────────────┐
                         │                           │
                         ▼                           ▼
                   ┌───────────┐               ┌───────────┐
                   │ Anonymous │               │Authenticated│
                   └─────┬─────┘               └─────┬─────┘
                         │                           │
                         ▼                           ▼
                   ┌───────────┐               ┌───────────────┐
                   │  DENIED   │               │Check Allowlist│
                   └───────────┘               └───────┬───────┘
                                                       │
                                         ┌─────────────┴─────────────┐
                                         │                           │
                                         ▼                           ▼
                                   ┌───────────┐               ┌───────────┐
                                   │Not Listed │               │  Listed   │
                                   └─────┬─────┘               └─────┬─────┘
                                         │                           │
                                         ▼                           ▼
                                   ┌───────────┐               ┌───────────┐
                                   │  DENIED   │               │Check Role │
                                   └───────────┘               └─────┬─────┘
                                                                     │
                                               ┌─────────────────────┼─────────────────────┐
                                               │                     │                     │
                                               ▼                     ▼                     ▼
                                         ┌───────────┐         ┌───────────┐         ┌───────────┐
                                         │  Viewer   │         │    PM     │         │   Admin   │
                                         │ Read Only │         │Read/Write │         │Full Access│
                                         └───────────┘         └───────────┘         └───────────┘
```

---

## Deployment Architecture

```
┌─────────────────────────────────────────────────────────────────────────────────────┐
│                              DEPLOYMENT OPTIONS                                      │
└─────────────────────────────────────────────────────────────────────────────────────┘


Option 1: Local Development
───────────────────────────

    ┌─────────────────────────────────────────┐
    │           Developer Machine             │
    │                                         │
    │   ┌─────────────────────────────────┐   │
    │   │     npm run dev (Vite)          │   │
    │   │     localhost:3000              │   │
    │   │     Hot Module Reload           │   │
    │   └─────────────────────────────────┘   │
    │                                         │
    └─────────────────────────────────────────┘


Option 2: Docker (Production)
─────────────────────────────

    ┌─────────────────────────────────────────┐
    │           Docker Host (NAS/Cloud)       │
    │                                         │
    │   ┌─────────────────────────────────┐   │
    │   │     Docker Container            │   │
    │   │     ┌─────────────────────────┐ │   │
    │   │     │   Nginx (Alpine)        │ │   │
    │   │     │   - Static React Build  │ │   │
    │   │     │   - SPA Routing         │ │   │
    │   │     │   - Gzip Compression    │ │   │
    │   │     │   - Health Endpoint     │ │   │
    │   │     └─────────────────────────┘ │   │
    │   │     Port: 80 → Host: 3001       │   │
    │   └─────────────────────────────────┘   │
    │                                         │
    └─────────────────────────────────────────┘

    Pull: docker pull nithinvaradaraj/onevalue-console:latest


Option 3: Docker Compose
────────────────────────

    ┌─────────────────────────────────────────┐
    │              docker-compose.yml         │
    │                                         │
    │   services:                             │
    │     onevalue-console:                   │
    │       image: nithinvaradaraj/...        │
    │       ports: "3001:80"                  │
    │       environment:                      │
    │         - VITE_SUPABASE_URL=...         │
    │         - VITE_SUPABASE_ANON_KEY=...    │
    │       healthcheck: /health              │
    │       restart: unless-stopped           │
    │                                         │
    └─────────────────────────────────────────┘
```

---

## Workflow Schedules

```
┌─────────────────────────────────────────────────────────────────────────────────────┐
│                              n8n WORKFLOW SCHEDULES                                  │
└─────────────────────────────────────────────────────────────────────────────────────┘

Timeline (24 hours, UTC)
────────────────────────

00:00   03:00   06:00   09:00   12:00   15:00   18:00   21:00   24:00
  │       │       │       │       │       │       │       │       │
  │       │       │       │       │       │       │       │       │
  ├───────┼───────┼───────┼───────┼───────┼───────┼───────┼───────┤  03_daily_delivery_poller
  │       │       │       ▲       │       │       │       │       │  (Daily 9 AM)
  │       │       │       │       │       │       │       │       │
  ├───┬───┼───┬───┼───┬───┼───┬───┼───┬───┼───┬───┼───┬───┼───┬───┤  04_ai_project_analyzer
  │   ▲   │   ▲   │   ▲   │   ▲   │   ▲   │   ▲   │   ▲   │   ▲   │  (Every 2 hours)
  │       │       │       │       │       │       │       │       │
  ▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲  06_critical_alerts_notifier
  │       │       │       │       │       │       │       │       │  (Every 15 min)
  │       │       │       │       │       │       │       │       │


Workflow Details
────────────────

┌────────────────────────┬─────────────────┬────────────────────────────────────┐
│ Workflow               │ Schedule        │ Purpose                            │
├────────────────────────┼─────────────────┼────────────────────────────────────┤
│ 01_historical_data_dump│ Manual          │ Initial Gmail + Chat data load     │
│ 02_sow_pdf_auto_ingest │ Hourly          │ Parse new SOW PDFs from Drive      │
│ 03_daily_delivery_poll │ Daily 9 AM UTC  │ Fetch new Chat messages            │
│ 04_ai_project_analyzer │ Every 2 hours   │ Claude AI analysis of comms        │
│ 05_alert_manager       │ On Error        │ Central error handling             │
│ 06_critical_notifier   │ Every 15 min    │ Alert on critical project health   │
└────────────────────────┴─────────────────┴────────────────────────────────────┘
```

---

## Technology Stack

```
┌─────────────────────────────────────────────────────────────────────────────────────┐
│                              TECHNOLOGY STACK                                        │
└─────────────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────────────┐
│ FRONTEND                                                                             │
│                                                                                      │
│   ┌───────────┐  ┌───────────┐  ┌───────────┐  ┌───────────┐  ┌───────────┐        │
│   │  React 18 │  │TypeScript │  │   Vite    │  │ Tailwind  │  │ TanStack  │        │
│   │           │  │           │  │           │  │    CSS    │  │   Query   │        │
│   └───────────┘  └───────────┘  └───────────┘  └───────────┘  └───────────┘        │
│                                                                                      │
│   ┌───────────┐  ┌───────────┐  ┌───────────┐  ┌───────────┐                       │
│   │  Lucide   │  │  Recharts │  │  Shadcn   │  │React Router│                       │
│   │   Icons   │  │  (Charts) │  │    UI     │  │           │                       │
│   └───────────┘  └───────────┘  └───────────┘  └───────────┘                       │
└─────────────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────────────┐
│ BACKEND                                                                              │
│                                                                                      │
│   ┌───────────────────────────────────────────────────────────────────────┐         │
│   │                          SUPABASE                                      │         │
│   │  ┌───────────┐  ┌───────────┐  ┌───────────┐  ┌───────────┐          │         │
│   │  │PostgreSQL │  │   Auth    │  │  Storage  │  │ Real-time │          │         │
│   │  │    15     │  │(Google SSO)│  │  (Files)  │  │(WebSocket)│          │         │
│   │  └───────────┘  └───────────┘  └───────────┘  └───────────┘          │         │
│   └───────────────────────────────────────────────────────────────────────┘         │
└─────────────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────────────┐
│ AUTOMATION                                                                           │
│                                                                                      │
│   ┌───────────────────────────────────────────────────────────────────────┐         │
│   │                          n8n CLOUD                                     │         │
│   │  ┌───────────┐  ┌───────────┐  ┌───────────┐  ┌───────────┐          │         │
│   │  │ Workflows │  │ Schedules │  │  Webhooks │  │Credentials│          │         │
│   │  │    (7)    │  │  (Cron)   │  │  (REST)   │  │  Vault    │          │         │
│   │  └───────────┘  └───────────┘  └───────────┘  └───────────┘          │         │
│   └───────────────────────────────────────────────────────────────────────┘         │
└─────────────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────────────┐
│ AI / ML                                                                              │
│                                                                                      │
│   ┌───────────────────────────────────────────────────────────────────────┐         │
│   │                        ANTHROPIC CLAUDE                                │         │
│   │  ┌───────────────────────────────────────────────────────────────┐    │         │
│   │  │  claude-sonnet-4-20250514                                      │    │         │
│   │  │  - Sentiment Analysis (-1.0 to 1.0)                           │    │         │
│   │  │  - Blocker Extraction                                          │    │         │
│   │  │  - Action Item Identification                                  │    │         │
│   │  │  - Health Assessment                                           │    │         │
│   │  └───────────────────────────────────────────────────────────────┘    │         │
│   └───────────────────────────────────────────────────────────────────────┘         │
└─────────────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────────────┐
│ DEPLOYMENT                                                                           │
│                                                                                      │
│   ┌───────────┐  ┌───────────┐  ┌───────────┐  ┌───────────┐                       │
│   │  Docker   │  │   Nginx   │  │  GitHub   │  │Docker Hub │                       │
│   │           │  │  (Alpine) │  │           │  │           │                       │
│   └───────────┘  └───────────┘  └───────────┘  └───────────┘                       │
└─────────────────────────────────────────────────────────────────────────────────────┘
```

---

## Database Schema (ERD)

```
┌─────────────────────────────────────────────────────────────────────────────────────┐
│                              ENTITY RELATIONSHIP DIAGRAM                             │
└─────────────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────┐         ┌─────────────────────┐
│   sow_contracts     │         │   chat_spaces       │
├─────────────────────┤         ├─────────────────────┤
│ PK id (UUID)        │         │ PK id (UUID)        │
│    project_name     │◄───┐    │    space_id         │
│    client_name      │    │    │    space_name       │
│    start_date       │    │    │    project_id (FK)──┼────┐
│    end_date         │    │    │    is_active        │    │
│    contract_value   │    │    └─────────────────────┘    │
│    scope_anchors[]  │    │                               │
│    status           │    │                               │
│    inferred_owner   │    │                               │
└─────────────────────┘    │                               │
          │                │                               │
          │ 1              │                               │
          │                │                               │
          ▼ N              │                               │
┌─────────────────────┐    │    ┌─────────────────────┐    │
│project_health_metrics│   │    │delivery_intelligence│    │
├─────────────────────┤    │    ├─────────────────────┤    │
│ PK id (UUID)        │    │    │ PK id (UUID)        │    │
│ FK project_id ──────┼────┘    │ FK project_id ──────┼────┤
│    metric_date      │         │    source           │    │
│    overall_health   │         │    event_type       │    │
│    health_score     │         │    title            │    │
│    blocker_count    │         │    content_raw      │    │
│    sentiment_trend  │         │    sentiment_score  │    │
│    renewal_risk     │         │    ai_processed     │    │
│    ai_summary       │         │    ai_insights      │    │
└─────────────────────┘         │    space_id         │    │
                                │    message_id       │    │
          ┌─────────────────────┼────evidence_link    │    │
          │                     └─────────────────────┘    │
          │                                                │
          │                     ┌─────────────────────┐    │
          │                     │   action_queue      │    │
          │                     ├─────────────────────┤    │
          │                     │ PK id (UUID)        │    │
          │                     │ FK project_id ──────┼────┘
          │                     │    title            │
          │                     │    description      │
          │                     │    owner            │
          │                     │    priority         │
          │                     │    status           │
          │                     │    due_date         │
          │                     └─────────────────────┘
          │
          │                     ┌─────────────────────┐
          │                     │  user_allowlist     │
          │                     ├─────────────────────┤
          │                     │ PK id (UUID)        │
          │                     │    email (UNIQUE)   │
          │                     │    display_name     │
          │                     │    role             │
          │                     │    is_active        │
          │                     │    last_login       │
          │                     └─────────────────────┘
          │
          │                     ┌─────────────────────┐
          └────────────────────►│  alert_notifications│
                                ├─────────────────────┤
                                │ PK id (UUID)        │
                                │ FK project_id       │
                                │    title            │
                                │    message          │
                                │    severity         │
                                │    status           │
                                │    triggered_at     │
                                └─────────────────────┘
```

---

*Generated: 2025-12-28*
*OneValue Delivery Intelligence Console v1.0*
